{% extends "base.html" %} {% block title %} Current Affairs {% endblock %} {%
block content %}
<div class="container mt-4">
  <!-- Mini Tab Navigation (Top Right) -->
  <ul
    class="nav nav-pills nav-fill bg-light rounded p-2 shadow-sm"
    id="newsTabs"
  >
    <li class="nav-item">
      <a class="nav-link active" data-tab="all" href="#">All</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-tab="world" href="#">World</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-tab="north_america" href="#">North America</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-tab="europe" href="#">Europe</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-tab="asia" href="#">Asia</a>
    </li>
  </ul>

  <!-- Two-Column Layout -->
  <div class="row mt-4">
    <!-- Left Column: Input Fields -->
    <div class="col-md-4">
      <div class="card shadow-sm p-3">
        <h6 class="text-center text-primary">Stock Symbols</h6>
        <form method="POST">
          <div id="sourceContainer">
            {% for i in range(1, 6) %}
            <div class="input-group mb-2">
              <span class="input-group-text">#{{ i }}</span>
              <input
                type="text"
                name="stock_symbols"
                class="form-control"
                placeholder="Enter STOCK SYMBOL AAPL/TSLA"
                value="{{ symbols[i-1] if symbols and i <= symbols|length else '' }}"
              />
            </div>
            {% endfor %}
          </div>
          <!-- Submit Button -->
          <button
            id="submitSources"
            type="submit"
            class="btn btn-primary btn-sm w-100 mt-2"
          >
            <i class="bi bi-check-lg"></i> Submit
          </button>
          <hr />
          <label class="small">Update Frequency</label>
          <select id="frequencyDropdown" class="form-select form-select-sm">
            <option value="all">All</option>
            <option value="2min">2 Min</option>
            <option value="5min">5 Min</option>
            <option value="10min">10 Min</option>
            <option value="20min">20 Min</option>
            <option value="30min">30 Min</option>
          </select>
        </form>
      </div>
    </div>

    <!-- Right Column: Table -->
    <div class="col-md-8">
      <div class="card shadow-sm p-3">
        <h6 class="text-center text-primary">News Feed</h6>
        <table class="table table-hover">
          <thead class="table-primary">
            <tr>
              <th>Content</th>
              <th>URL</th>
              <th>Image</th>
            </tr>
          </thead>
          <tbody id="newsTableBody">
            {% for news in news_data %}
            <tr data-category="{{ news.category }}">
              <td>{{ news.content }}</td>
              <!-- Title for content -->
              <td>
                <a
                  href="{{ news.url }}"
                  target="_blank"
                  class="text-decoration-none text-primary"
                >
                  {{ news.url }}
                  <!-- Article URL -->
                </a>
              </td>
              <td>
                <img
                  src="{{ news.image_url }}"
                  class="rounded shadow"
                  alt="News Image"
                  width="100"
                />
                <!-- Image for article -->
              </td>
            </tr>
            {% endfor %} {% if stock_data %} {% for symbol, data in
            stock_data.items() %}
            <tr>
              <td colspan="3" class="text-center text-primary">
                <strong>Stock Data for {{ symbol }}</strong>
              </td>
            </tr>
            <tr>
              <td>Stock Data (Last 5 Days)</td>
              <td colspan="2">
                <pre>{{ data.to_string() }}</pre>
                <!-- Display stock data -->
              </td>
            </tr>
            {% endfor %} {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    let tabs = document.querySelectorAll("#newsTabs .nav-link");
    tabs.forEach((tab) => {
      tab.addEventListener("click", function (e) {
        e.preventDefault();
        tabs.forEach((t) => t.classList.remove("active"));
        this.classList.add("active");

        let selectedCategory = this.getAttribute("data-tab");
        document.querySelectorAll("#newsTableBody tr").forEach((row) => {
          if (
            selectedCategory === "all" ||
            row.getAttribute("data-category") === selectedCategory
          ) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      });
    });

    // Add new stock symbol input field
    document.getElementById("addSource").addEventListener("click", function () {
      let sourceContainer = document.getElementById("sourceContainer");
      let count =
        sourceContainer.getElementsByClassName("input-group").length + 1;
      let newSource = document.createElement("div");
      newSource.classList.add("input-group", "mb-2");
      newSource.innerHTML = `<span class="input-group-text">#${count}</span>
      <input type="text" name="stock_symbols" class="form-control" placeholder="Enter STOCK SYMBOL">`;
      sourceContainer.appendChild(newSource);
    });
  });
</script>
{% endblock %}
