<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sector Sentiment Analysis</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); min-height: 100vh; padding: 20px; }
.container { background: rgba(255,255,255,0.97); border-radius: 24px; padding: 25px; max-width: 1200px; margin: 0 auto; box-shadow: 0 25px 80px rgba(0,0,0,0.4); }
.header { background: linear-gradient(135deg, #ff6b9d, #c44569, #ff6b9d); padding: 22px; text-align: center; border-radius: 16px; margin-bottom: 20px; position: relative; overflow: hidden; }
.header::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(255,255,255,0.15), transparent); animation: shimmer 3s infinite; }
@keyframes shimmer { 0% { transform: translateX(-100%) rotate(45deg); } 100% { transform: translateX(100%) rotate(45deg); } }
.header h1 { font-size: 26px; color: white; font-weight: 700; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); position: relative; z-index: 1; }

/* Navigation */
.nav-bar { display: flex; align-items: center; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; justify-content: center; }
.nav-btn { display: flex; align-items: center; gap: 8px; padding: 11px 18px; border-radius: 30px; border: none; background: linear-gradient(135deg, #f8f9fa, #e9ecef); cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
.nav-btn:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
.nav-btn.active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
.nav-btn .icon { font-size: 16px; }
.arrow-btn { width: 42px; height: 42px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; cursor: pointer; font-size: 20px; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102,126,234,0.4); }
.arrow-btn:hover { transform: scale(1.1); }

/* MyList Container Header Styles */
.mylist-header { 
    display: flex; 
    align-items: center; 
    gap: 12px; 
    margin-bottom: 15px; 
    padding: 14px 20px; 
    background: linear-gradient(135deg, #e3f2fd, #bbdefb); 
    border-radius: 14px; 
    flex-wrap: wrap;
}
.mylist-title { 
    display: flex; 
    align-items: center; 
    gap: 10px; 
    flex: 1;
}

.mylist-title span:first-child { 
    font-size: 22px; 
}
.mylist-name-edit { 
    display: flex; 
    align-items: center; 
    gap: 8px; 
}
.mylist-name-display { 
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600; 
    color: #1565c0; 
    font-size: 15px; 
    cursor: pointer; 
    padding: 4px 8px; 
    border-radius: 6px; 
    transition: all 0.2s; 
}
.mylist-name-display:hover { 
    background: rgba(255,255,255,0.5); 
}
.mylist-name-display:hover .edit-icon-container {
    opacity: 1;
}
.edit-icon-container {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    opacity: 0.6;
    transition: opacity 0.2s;
}
.edit-icon {
    font-size: 14px;
}

.mylist-name-input { 
    background: white; 
    border: 1px solid #90caf9; 
    border-radius: 8px; 
    padding: 4px 8px; 
    color: #1565c0; 
    font-weight: 600; 
    width: 150px; 
    font-size: 15px; 
}
.mylist-name-input:focus { 
    outline: none; 
    border-color: #42a5f5; 
    box-shadow: 0 0 0 2px rgba(66,165,245,0.2); 
}

/* Action Buttons in MyList Container */
.mylist-actions { 
    display: flex; 
    gap: 8px; 
    flex-wrap: wrap;
}
.mylist-action-btn { 
    display: flex; 
    align-items: center; 
    gap: 6px; 
    padding: 8px 12px; 
    border-radius: 20px; 
    border: none; 
    background: linear-gradient(135deg, #f8f9fa, #e9ecef); 
    cursor: pointer; 
    font-size: 12px; 
    font-weight: 600; 
    transition: all 0.3s; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.08); 
}
.mylist-action-btn:hover { 
    transform: translateY(-2px); 
    box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
}
.mylist-action-btn.guide { 
    background: linear-gradient(135deg, #4fc3f7, #0288d1); 
    color: white; 
}
.mylist-action-btn.keyword { 
    background: linear-gradient(135deg, #81c784, #388e3c); 
    color: white; 
}
.mylist-action-btn.export { 
    background: linear-gradient(135deg, #ffb74d, #f57c00); 
    color: white; 
}
.mylist-action-btn.compare { 
    background: linear-gradient(135deg, #ba68c8, #7b1fa2); 
    color: white; 
}

/* Layout */
.main-content { display: flex; gap: 25px; flex-wrap: wrap; }
.sidebar { width: 230px; flex-shrink: 0; }
@media (max-width: 900px) { 
    .sidebar { width: 100%; } 
    .main-content { flex-direction: column; } 
    .mylist-header { flex-direction: column; align-items: flex-start; }
    .mylist-actions { justify-content: flex-start; width: 100%; }
}
.sidebar-box { background: linear-gradient(180deg, #f8f9fa, #fff); border-radius: 18px; padding: 22px; box-shadow: 0 10px 35px rgba(0,0,0,0.08); border: 1px solid rgba(102,126,234,0.15); }
.sidebar-title { font-weight: 700; margin-bottom: 18px; color: #1a1a2e; font-size: 15px; display: flex; align-items: center; gap: 8px; }

/* Analysis Section */
.analysis-section { margin-top: 20px; padding: 18px; background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-radius: 14px; }
.analysis-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; margin-top: 15px; }
.analysis-header:first-child { margin-top: 0; }
.analysis-icon { font-size: 22px; }
.analysis-label { font-weight: 600; color: #1565c0; font-size: 14px; }
.analysis-select { width: 100%; padding: 11px 14px; border-radius: 10px; border: 2px solid #90caf9; background: white; font-size: 13px; cursor: pointer; transition: all 0.3s; margin-bottom: 10px; }
.analysis-select:focus { outline: none; border-color: #42a5f5; box-shadow: 0 0 0 4px rgba(66,165,245,0.2); }
.analyze-btn { width: 100%; padding: 14px; border: none; border-radius: 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102,126,234,0.4); display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 10px; }
.analyze-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102,126,234,0.5); }
.analyze-btn:disabled { background: #bdbdbd; cursor: not-allowed; transform: none; box-shadow: none; }

/* Test Button */
.test-btn { 
    width: 100%; 
    padding: 12px; 
    border: none; 
    border-radius: 12px; 
    background: linear-gradient(135deg, #4caf50, #2e7d32); 
    color: white; 
    font-weight: 600; 
    font-size: 14px; 
    cursor: pointer; 
    transition: all 0.3s; 
    box-shadow: 0 4px 15px rgba(76,175,80,0.4); 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    gap: 8px; 
    margin-top: 15px;
}
.test-btn:hover { 
    transform: translateY(-2px); 
    box-shadow: 0 6px 20px rgba(76,175,80,0.5); 
}
.test-btn:disabled { 
    background: #bdbdbd; 
    cursor: not-allowed; 
    transform: none; 
    box-shadow: none; 
}

/* Status & Timer */
.timer-display { text-align: center; margin-top: 15px; font-size: 14px; font-weight: 600; color: #1565c0; }
.status-display { text-align: center; margin-top: 5px; font-size: 12px; color: #666; }

/* Line Timer Styles */
.timer-line-container {
    margin-top: 15px;
    display: none; /* Hidden by default */
}
.timer-text-small {
    font-size: 11px;
    color: #666;
    margin-bottom: 5px;
    display: flex;
    justify-content: space-between;
}
.timer-line-track {
    width: 100%;
    height: 6px;
    background: rgba(255,255,255,0.5);
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.8);
}
.timer-line-fill {
    height: 100%;
    width: 100%;
    background: linear-gradient(90deg, #43a047, #66bb6a);
    border-radius: 10px;
    transition: width 1s linear, background 0.3s;
}
.timer-line-fill.warning { background: linear-gradient(90deg, #fdd835, #ffee58); }
.timer-line-fill.danger { background: linear-gradient(90deg, #e53935, #ef5350); }

/* Table */
.table-container { flex: 1; min-width: 0; }
.table-wrapper { background: white; border-radius: 18px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.08); }
.data-table { width: 100%; border-collapse: collapse; }
.data-table th { background: linear-gradient(135deg, #00897b, #00796b); color: white; padding: 16px 12px; text-align: center; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
.data-table td { padding: 14px 10px; text-align: center; border-bottom: 1px solid #eee; font-size: 13px; transition: all 0.3s; }
.data-table tbody tr:hover { background: linear-gradient(135deg, #e0f7fa, #e8f5e9); }
.data-table tbody tr:nth-child(even) { background: #fafbfc; }
.emoji { font-size: 20px; display: block; margin-bottom: 4px; }
.score-cell { font-weight: 600; font-size: 13px; }
.score-sad { color: #e53935; }
.score-neutral { color: #f57c00; }
.score-happy { color: #43a047; }
.rag-cell { display: flex; justify-content: center; }
.rag-dot { width: 26px; height: 26px; border-radius: 50%; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: all 0.3s; cursor: pointer; }
.rag-dot:hover { transform: scale(1.25); }
.rag-green { background: linear-gradient(135deg, #66bb6a, #43a047); }
.rag-yellow { background: linear-gradient(135deg, #ffee58, #fdd835); }
.rag-red { background: linear-gradient(135deg, #ef5350, #e53935); }
.rag-header { display: flex; gap: 4px; justify-content: center; margin-bottom: 4px; }
.rag-header span { width: 12px; height: 12px; border-radius: 50%; }
.company-name { font-weight: 600; color: #1a1a2e; }
.sector-badge { display: inline-block; padding: 5px 12px; background: linear-gradient(135deg, #ede7f6, #d1c4e9); color: #5e35b1; border-radius: 20px; font-size: 11px; font-weight: 600; }
.empty-cell { color: #bdbdbd; font-style: italic; }
.loading-cell { color: #667eea; font-weight: 600; animation: pulse 1.5s infinite; }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

/* Actions & Modal */
.actions-cell { display: flex; gap: 6px; justify-content: center; flex-wrap: wrap; }
.action-btn { width: 32px; height: 32px; border-radius: 10px; border: none; cursor: pointer; font-size: 14px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; }
.action-btn:hover { transform: translateY(-3px) scale(1.1); }
.btn-edit { background: linear-gradient(135deg, #42a5f5, #1e88e5); color: white; box-shadow: 0 4px 12px rgba(30,136,229,0.35); }
.btn-delete { background: linear-gradient(135deg, #ef5350, #e53935); color: white; box-shadow: 0 4px 12px rgba(229,57,53,0.35); }
.btn-up { background: linear-gradient(135deg, #66bb6a, #43a047); color: white; box-shadow: 0 4px 12px rgba(67,160,71,0.35); }
.btn-down { background: linear-gradient(135deg, #ffa726, #fb8c00); color: white; box-shadow: 0 4px 12px rgba(251,140,0,0.35); }
.add-row-btn { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 16px; background: linear-gradient(135deg, #e8f5e9, #c8e6c9); border: 2px dashed #81c784; cursor: pointer; transition: all 0.3s; color: #2e7d32; font-weight: 600; font-size: 14px; }
.add-row-btn:hover { background: linear-gradient(135deg, #c8e6c9, #a5d6a7); border-color: #66bb6a; }

.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); justify-content: center; align-items: center; z-index: 1000; }
.modal { background: white; border-radius: 24px; padding: 30px; width: 95%; max-width: 420px; box-shadow: 0 25px 80px rgba(0,0,0,0.3); animation: modalIn 0.4s ease; }
@keyframes modalIn { from { opacity: 0; transform: scale(0.9) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
.modal h2 { margin-bottom: 25px; color: #1a1a2e; font-size: 22px; display: flex; align-items: center; gap: 10px; }
.form-group { margin-bottom: 18px; }
.form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; font-size: 13px; }
.form-group input, .form-group select { width: 100%; padding: 14px 16px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 14px; transition: all 0.3s; }
.form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 4px rgba(102,126,234,0.15); }
.modal-actions { display: flex; gap: 12px; margin-top: 25px; }
.modal-btn { flex: 1; padding: 14px; border: none; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
.modal-btn:hover { transform: translateY(-2px); }
.btn-cancel { background: #f5f5f5; color: #666; }
.btn-cancel:hover { background: #eeeeee; }
.btn-save { background: linear-gradient(135deg, #667eea, #764ba2); color: white; box-shadow: 0 4px 15px rgba(102,126,234,0.4); }
.btn-save:hover { box-shadow: 0 6px 20px rgba(102,126,234,0.5); }
.toast { position: fixed; bottom: 30px; right: 30px; padding: 16px 24px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 14px; font-weight: 500; box-shadow: 0 10px 40px rgba(0,0,0,0.3); transform: translateY(100px); opacity: 0; transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); z-index: 2000; }
.toast.show { transform: translateY(0); opacity: 1; }
.loading-bar { height: 4px; background: linear-gradient(90deg, #667eea, #764ba2, #667eea); background-size: 200% 100%; animation: loading 1.5s infinite; border-radius: 2px; margin-bottom: 15px; }
@keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

/* Tab-specific MyList header styles */
.mylist-header.semiconductor { background: linear-gradient(135deg, #e3f2fd, #bbdefb); }
.mylist-header.pharma { background: linear-gradient(135deg, #e8f5e9, #c8e6c9); }
.mylist-header.electricity { background: linear-gradient(135deg, #fff3e0, #ffe0b2); }
.mylist-header.mining { background: linear-gradient(135deg, #fbe9e7, #ffccbc); }
.mylist-header.automobile { background: linear-gradient(135deg, #f3e5f5, #e1bee7); }
.mylist-header.quantum { background: linear-gradient(135deg, #e0f2f1, #b2dfdb); }

/* FIXED: Enhanced Modal Styles with Better Button Placement */
.guide-modal, .keyword-modal, .export-modal, .compare-modal, .test-modal {
    max-width: 800px;
    width: 95%;
    max-height: 90vh; /* Reduced from 85vh to 90vh for better fit */
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.modal-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 20px 30px;
    border-radius: 20px 20px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0; /* Prevent header from shrinking */
}

.modal-header h2 {
    color: white;
    margin: 0;
    font-size: 24px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.modal-close {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.3s;
}

.modal-close:hover {
    background: rgba(255,255,255,0.2);
}

.modal-body {
    padding: 30px;
    flex: 1;
    overflow-y: auto;
    max-height: calc(90vh - 140px); /* Adjusted calculation */
}

/* NEW: Fixed Modal Actions Sticky Footer */
.modal-actions-sticky {
    padding: 20px 30px;
    background: rgba(248, 249, 250, 0.95);
    border-top: 1px solid #e9ecef;
    border-radius: 0 0 20px 20px;
    display: flex;
    gap: 12px;
    flex-shrink: 0; /* Prevent footer from shrinking */
    position: sticky;
    bottom: 0;
    z-index: 10;
}

.modal-actions-sticky .modal-btn {
    flex: 1;
    padding: 14px;
    border: none;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.modal-actions-sticky .modal-btn:hover {
    transform: translateY(-2px);
}

.modal-actions-sticky .btn-cancel {
    background: #f5f5f5;
    color: #666;
}

.modal-actions-sticky .btn-cancel:hover {
    background: #eeeeee;
}

.modal-actions-sticky .btn-save {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    box-shadow: 0 4px 15px rgba(102,126,234,0.4);
}

.modal-actions-sticky .btn-save:hover {
    box-shadow: 0 6px 20px rgba(102,126,234,0.5);
}

/* NEW: Test Action Buttons - Fixed Positioning */
.test-action-buttons {
    display: flex;
    gap: 12px;
    margin: 20px 0;
    padding: 15px 0;
    border-top: 1px solid #e9ecef;
    border-bottom: 1px solid #e9ecef;
}

.test-action-buttons .modal-btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

/* NEW: Visual Charts Styles */
.chart-container {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    border: 1px solid #e9ecef;
}

.chart-title {
    font-size: 18px;
    font-weight: 600;
    color: #1a1a2e;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.sentiment-chart {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.chart-bar {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    position: relative;
    overflow: hidden;
}

.chart-bar-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-weight: 600;
    color: #1a1a2e;
}

.chart-bar-track {
    width: 100%;
    height: 20px;
    background: #e9ecef;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
}

.chart-bar-fill {
    height: 100%;
    border-radius: 10px;
    transition: width 1s ease-in-out;
    position: relative;
}

.chart-bar-fill.happy { background: linear-gradient(90deg, #4caf50, #66bb6a); }
.chart-bar-fill.neutral { background: linear-gradient(90deg, #ff9800, #ffb74d); }
.chart-bar-fill.sad { background: linear-gradient(90deg, #f44336, #ef5350); }

.chart-bar-value {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 12px;
    font-weight: 600;
    color: #1a1a2e;
    text-shadow: 0 0 2px white;
}

/* NEW: Pie Chart Styles */
.pie-chart-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 20px 0;
}

.pie-chart {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background: conic-gradient(
        #4caf50 0% var(--happy-percent, 0%),
        #ff9800 var(--happy-percent, 0%) calc(var(--happy-percent, 0%) + var(--neutral-percent, 0%)),
        #f44336 calc(var(--happy-percent, 0%) + var(--neutral-percent, 0%)) 100%
    );
    position: relative;
}

.pie-chart-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: #1a1a2e;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.pie-legend {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 15px;
    flex-wrap: wrap;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
}

.legend-color {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.legend-color.happy { background: #4caf50; }
.legend-color.neutral { background: #ff9800; }
.legend-color.sad { background: #f44336; }

/* Guide Modal Specific Styles */
.guide-section {
    margin-bottom: 30px;
}

.guide-section h3 {
    color: #1a1a2e;
    margin-bottom: 15px;
    font-size: 18px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.guide-section p {
    color: #555;
    line-height: 1.6;
    margin-bottom: 15px;
}

.feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.feature-card {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    padding: 20px;
    border-radius: 12px;
    border-left: 4px solid #667eea;
}

.feature-card h4 {
    color: #1a1a2e;
    margin-bottom: 10px;
    font-size: 16px;
}

.feature-card ul {
    list-style: none;
    padding: 0;
}

.feature-card li {
    padding: 5px 0;
    color: #555;
    display: flex;
    align-items: center;
    gap: 8px;
}

.feature-card li:before {
    content: "‚úì";
    color: #4caf50;
    font-weight: bold;
}

/* Keyword Modal Specific Styles */
.keyword-categories {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.keyword-category {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}

.keyword-category h4 {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    color: #1a1a2e;
    font-size: 16px;
}

.keyword-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    max-height: 200px;
    overflow-y: auto;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 8px;
}

.keyword-tag {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    color: #1565c0;
}

.keyword-tag.happy { background: linear-gradient(135deg, #e8f5e9, #c8e6c9); color: #2e7d32; }
.keyword-tag.neutral { background: linear-gradient(135deg, #f5f5f5, #eeeeee); color: #616161; }
.keyword-tag.sad { background: linear-gradient(135deg, #ffebee, #ffcdd2); color: #c62828; }

/* Export Modal Specific Styles */
.export-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.export-option {
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
}

.export-option:hover {
    border-color: #667eea;
    transform: translateY(-2px);
}

.export-option.selected {
    border-color: #667eea;
    background: linear-gradient(135deg, #f0f4ff, #e3f2fd);
}

.export-option .icon {
    font-size: 32px;
    margin-bottom: 10px;
}

.export-option h4 {
    color: #1a1a2e;
    margin-bottom: 8px;
}

.export-option p {
    color: #666;
    font-size: 12px;
}

/* Compare Modal Specific Styles */
.comparison-results {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
}

.comparison-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: white;
    border-radius: 8px;
    margin-bottom: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.comparison-item:last-child {
    margin-bottom: 0;
}

.comparison-label {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 600;
    color: #1a1a2e;
}

.comparison-value {
    font-weight: 600;
    color: #667eea;
}

/* Test Modal Specific Styles */
.test-results {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
}

.score-breakdown {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 15px 0;
}

.score-item {
    background: white;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.score-value {
    font-size: 24px;
    font-weight: bold;
    margin: 10px 0;
}

.score-label {
    font-size: 12px;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.keyword-highlight {
    background: #fff9c4;
    padding: 2px 4px;
    border-radius: 4px;
    font-weight: 500;
}

.keyword-highlight.positive {
    background: #c8e6c9;
    color: #2e7d32;
}

.keyword-highlight.negative {
    background: #ffcdd2;
    color: #c62828;
}

/* Enhanced responsive design for modals */
@media (max-width: 768px) {
    .modal {
        width: 98%;
        margin: 10px;
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .modal-header {
        padding: 15px 20px;
    }
    
    .modal-actions-sticky {
        padding: 15px 20px;
        flex-direction: column;
    }
    
    .sentiment-chart {
        grid-template-columns: 1fr;
    }
    
    .test-action-buttons {
        flex-direction: column;
    }
    
    .feature-grid,
    .keyword-categories,
    .export-options {
        grid-template-columns: 1fr;
    }
}

/* Enhanced scrollbar for modal body */
.modal-body::-webkit-scrollbar {
    width: 6px;
}

.modal-body::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.modal-body::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.modal-body::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}
</style>
</head>
<body>
<div class="container">
  <div class="header"><h1>üìä Sector Sentiment Analysis</h1></div>
  <div class="loading-bar"></div>
  
  <div class="nav-bar">
    <button class="arrow-btn">‚Äπ</button>
    <button class="nav-btn active" data-sector="mylist"><span class="icon">üìã</span><span class="tab-name">My List</span></button>
    <button class="nav-btn" data-sector="Semiconductor"><span class="icon">üíæ</span><span class="tab-name">Semiconductors</span></button>
    <button class="nav-btn" data-sector="Pharma"><span class="icon">üíä</span><span class="tab-name">Pharma</span></button>
    <button class="nav-btn" data-sector="Electricity"><span class="icon">‚ö°</span><span class="tab-name">Electricity</span></button>
    <button class="nav-btn" data-sector="Mining"><span class="icon">‚õèÔ∏è</span><span class="tab-name">Mining</span></button>
    <button class="nav-btn" data-sector="Automobile"><span class="icon">üöó</span><span class="tab-name">Automobile</span></button>
    <button class="nav-btn" data-sector="Quantum"><span class="icon">‚öõÔ∏è</span><span class="tab-name">Quantum</span></button>
    <button class="arrow-btn">‚Ä∫</button>
  </div>

  <div class="main-content">
    <div class="sidebar">
      <div class="sidebar-box">
        <div class="sidebar-title">‚öôÔ∏è Analysis Parameters</div>
        
        <div class="analysis-section">
          <div class="analysis-header">
            <span class="analysis-icon">üîç</span>
            <span class="analysis-label">Analysis Depth</span>
          </div>
          <select class="analysis-select" id="analysisDepth">
            <option value="basic">Basic Analysis</option>
            <option value="standard" selected>Standard Analysis</option>
            <option value="comprehensive">Comprehensive Analysis</option>
            <option value="advanced">Advanced Analysis</option>
          </select>
          
          <div class="analysis-header">
            <span class="analysis-icon">‚è±Ô∏è</span>
            <span class="analysis-label">Refresh Timer</span>
          </div>
          <select class="analysis-select" id="timerSelect">
            <option value="0">Off (Manual)</option>
            <option value="15">15 Minutes</option>
            <option value="30">30 Minutes</option>
            <option value="45">45 Minutes</option>
            <option value="60">60 Minutes</option>
          </select>
          
          <button class="analyze-btn" id="analyzeBtn">
            <span class="icon">üöÄ</span>
            <span>Analyze All</span>
          </button>
          
          <div class="timer-display" id="timerDisplay">Ready</div>
          <div class="status-display" id="statusDisplay">Click analyze to start</div>
          
          <div class="timer-line-container" id="timerLineContainer">
            <div class="timer-text-small">
              <span>Auto-refresh</span>
              <span id="timerTextTime">00:00</span>
            </div>
            <div class="timer-line-track">
              <div class="timer-line-fill" id="timerLineFill"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- NEW: Test Button -->
      <button class="test-btn" id="testBtn">
        <span class="icon">üß™</span>
        <span>Test</span>
      </button>
    </div>
    
    <div class="table-container">
      <!-- NEW: MyList Container Header with Edit Name and Action Buttons -->
      <div class="mylist-header" id="mylistHeader">
        <div class="mylist-title">
          <span>üîë</span>
          <div class="mylist-name-edit">
            <span class="mylist-name-display" id="mylistNameDisplay">
              <span id="mylistNameText">My List</span>
              <div class="edit-icon-container">
                <span class="edit-icon">‚úèÔ∏è</span>
              </div>
            </span>
            <input type="text" class="mylist-name-input" id="mylistNameInput" value="My List" style="display: none">
          </div>
        </div>
        <div class="mylist-actions">
          <button class="mylist-action-btn guide" id="guideBtn">
            <span class="icon">üìñ</span>
            <span>Guide</span>
          </button>
          <button class="mylist-action-btn keyword" id="keywordRefBtn">
            <span class="icon">üîë</span>
            <span>Keyword Reference</span>
          </button>
          <button class="mylist-action-btn export" id="exportBtn">
            <span class="icon">üì§</span>
            <span>Export</span>
          </button>
          <button class="mylist-action-btn compare" id="compareBtn">
            <span class="icon">üìä</span>
            <span>Compare</span>
          </button>
        </div>
      </div>
      
      <div class="table-wrapper">
        <table class="data-table">
          <thead>
            <tr>
              <th>No</th>
              <th>Companies</th>
              <th>Sector</th>
              <th><span class="emoji">üò¢</span>Sad %</th>
              <th><span class="emoji">üòê</span>Neutral %</th>
              <th><span class="emoji">üòä</span>Happy %</th>
              <th><div class="rag-header"><span style="background:#e53935"></span><span style="background:#fdd835"></span><span style="background:#43a047"></span></div>RAG</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
        <div class="add-row-btn" onclick="openModal()">
          <span style="font-size:20px">‚ûï</span>
          <span>Add New Company</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Main Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <h2 id="modalTitle">‚ú® Add Company</h2>
    <div class="form-group">
      <label>Company Name</label>
      <input type="text" id="companyName" placeholder="Enter company name...">
    </div>
    <div class="form-group">
      <label>Sector</label>
      <select id="sectorSelect">
        <option value="Semiconductor">üíæ Semiconductor</option>
        <option value="Pharma">üíä Pharma</option>
        <option value="Electricity">‚ö° Electricity</option>
        <option value="Mining">‚õèÔ∏è Mining</option>
        <option value="Automobile">üöó Automobile</option>
        <option value="Quantum">‚öõÔ∏è Quantum</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="modal-btn btn-cancel" onclick="closeModal()">Cancel</button>
      <button class="modal-btn btn-save" onclick="saveCompany()">üíæ Save</button>
    </div>
  </div>
</div>

<!-- Enhanced Guide Modal -->
<div class="modal-overlay" id="guideModal" style="display: none;">
  <div class="modal guide-modal">
    <div class="modal-header">
      <h2><span class="icon">üìñ</span> Sector Sentiment Analysis - Complete Guide</h2>
      <button class="modal-close" onclick="closeGuideModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="guide-section">
        <h3><span class="icon">üéØ</span> Welcome to Sector Sentiment Analysis</h3>
        <p>This powerful tool helps you analyze the sentiment of companies across different sectors based on their news coverage, public perception, and market data. Here's how to make the most of it:</p>
        
        <div class="feature-grid">
          <div class="feature-card">
            <h4>üìã My List Management</h4>
            <ul>
              <li><strong>Custom Lists:</strong> Create and manage your own company watchlists</li>
              <li><strong>Edit Names:</strong> Click the pencil icon to rename your lists</li>
              <li><strong>Drag & Drop:</strong> Reorder companies using up/down arrows</li>
              <li><strong>Cross-Sector:</strong> Mix companies from different sectors in one list</li>
            </ul>
          </div>
          <div class="feature-card">
            <h4>üìä Sentiment Analysis</h4>
            <ul>
              <li><strong>Real-time Scoring:</strong> Get up-to-date sentiment percentages</li>
              <li><strong>Emotion Classification:</strong> Happy üòä, Neutral üòê, Sad üò¢ scores</li>
              <li><strong>RAG Status:</strong> Quick visual indicators (Red/Amber/Green)</li>
              <li><strong>Multi-Sector:</strong> Compare across different industries</li>
            </ul>
          </div>
          <div class="feature-card">
            <h4>‚öôÔ∏è Advanced Features</h4>
            <ul>
              <li><strong>Auto-Refresh:</strong> Set automatic analysis intervals</li>
              <li><strong>Export Data:</strong> Download results in multiple formats</li>
              <li><strong>Comparison Tools:</strong> Compare company performance</li>
              <li><strong>Text Testing:</strong> Test sentiment analysis on custom text</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="guide-section">
        <h3><span class="icon">üöÄ</span> Getting Started - Step by Step</h3>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin: 15px 0;">
          <h4 style="color: #1a1a2e; margin-bottom: 15px;">Step 1: Navigate Between Sectors</h4>
          <p>Use the navigation bar to switch between different sector views:</p>
          <ul style="color: #555; line-height: 1.6;">
            <li><strong>My List:</strong> Your custom company collection</li>
            <li><strong>Semiconductor üíæ:</strong> Tech and chip manufacturers</li>
            <li><strong>Pharma üíä:</strong> Pharmaceutical and healthcare companies</li>
            <li><strong>Electricity ‚ö°:</strong> Energy and utility providers</li>
            <li><strong>Mining ‚õèÔ∏è:</strong> Natural resource extraction companies</li>
            <li><strong>Automobile üöó:</strong> Automotive manufacturers</li>
            <li><strong>Quantum ‚öõÔ∏è:</strong> Quantum computing and advanced tech</li>
          </ul>
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin: 15px 0;">
          <h4 style="color: #1a1a2e; margin-bottom: 15px;">Step 2: Add Companies to Your List</h4>
          <p>Click the "‚ûï Add New Company" button at the bottom of the table to:</p>
          <ul style="color: #555; line-height: 1.6;">
            <li>Enter company name</li>
            <li>Select appropriate sector</li>
            <li>Save to start tracking sentiment</li>
          </ul>
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin: 15px 0;">
          <h4 style="color: #1a1a2e; margin-bottom: 15px;">Step 3: Configure Analysis Settings</h4>
          <p>Use the sidebar to customize your analysis:</p>
          <ul style="color: #555; line-height: 1.6;">
            <li><strong>Analysis Depth:</strong> Choose from Basic to Advanced analysis levels</li>
            <li><strong>Refresh Timer:</strong> Set automatic refresh intervals (15-60 minutes)</li>
            <li><strong>Manual Analysis:</strong> Use "Analyze All" for immediate updates</li>
          </ul>
        </div>
      </div>
      
      <div class="guide-section">
        <h3><span class="icon">üìä</span> Understanding the Results Table</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
          <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #43a047;">
            <h4 style="color: #43a047; margin-bottom: 10px;">üòä Happy Score (Green)</h4>
            <p style="color: #555; font-size: 14px;">Percentage of positive sentiment indicators. Scores above 70% indicate strong positive sentiment.</p>
            <ul style="color: #555; font-size: 13px;">
              <li>70%+: Very Positive</li>
              <li>50-70%: Positive</li>
              <li>Below 50%: Limited Positive</li>
            </ul>
          </div>
          
          <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #f57c00;">
            <h4 style="color: #f57c00; margin-bottom: 10px;">üòê Neutral Score (Amber)</h4>
            <p style="color: #555; font-size: 14px;">Percentage of factual or balanced content. High neutral scores indicate objective reporting.</p>
            <ul style="color: #555; font-size: 13px;">
              <li>High %: Factual reporting</li>
              <li>Balanced: Mixed sentiment</li>
              <li>Context matters</li>
            </ul>
          </div>
          
          <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #e53935;">
            <h4 style="color: #e53935; margin-bottom: 10px;">üò¢ Sad Score (Red)</h4>
            <p style="color: #555; font-size: 14px;">Percentage of negative sentiment indicators. Scores above 70% indicate strong negative sentiment.</p>
            <ul style="color: #555; font-size: 13px;">
              <li>70%+: Very Negative</li>
              <li>50-70%: Negative</li>
              <li>Below 50%: Limited Negative</li>
            </ul>
          </div>
        </div>
        
        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
          <h4 style="color: #1565c0; margin-bottom: 10px;">üéØ RAG Status Indicators</h4>
          <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
            <div style="text-align: center;">
              <div style="width: 20px; height: 20px; background: #43a047; border-radius: 50%; margin: 0 auto 5px;"></div>
              <span style="font-size: 12px; color: #555;">Green: Positive</span>
            </div>
            <div style="text-align: center;">
              <div style="width: 20px; height: 20px; background: #fdd835; border-radius: 50%; margin: 0 auto 5px;"></div>
              <span style="font-size: 12px; color: #555;">Amber: Neutral</span>
            </div>
            <div style="text-align: center;">
              <div style="width: 20px; height: 20px; background: #e53935; border-radius: 50%; margin: 0 auto 5px;"></div>
              <span style="font-size: 12px; color: #555;">Red: Negative</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- NEW: Visual Charts Section in Guide -->
      <div class="guide-section">
        <h3><span class="icon">üìä</span> Understanding Sentiment Charts</h3>
        
        <div class="chart-container">
          <div class="chart-title">üìà Sample Sentiment Analysis</div>
          <div class="sentiment-chart">
            <div class="chart-bar">
              <div class="chart-bar-label">
                <span>üòä Happy</span>
                <span class="chart-bar-value">65%</span>
              </div>
              <div class="chart-bar-track">
                <div class="chart-bar-fill happy" style="width: 65%"></div>
              </div>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-label">
                <span>üòê Neutral</span>
                <span class="chart-bar-value">25%</span>
              </div>
              <div class="chart-bar-track">
                <div class="chart-bar-fill neutral" style="width: 25%"></div>
              </div>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-label">
                <span>üò¢ Sad</span>
                <span class="chart-bar-value">10%</span>
              </div>
              <div class="chart-bar-track">
                <div class="chart-bar-fill sad" style="width: 10%"></div>
              </div>
            </div>
          </div>
          
          <div class="pie-chart-container">
            <div class="pie-chart" style="--happy-percent: 65%; --neutral-percent: 25%; --sad-percent: 10%;">
              <div class="pie-chart-center">Total</div>
            </div>
          </div>
          <div class="pie-legend">
            <div class="legend-item">
              <div class="legend-color happy"></div>
              <span>Happy (65%)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color neutral"></div>
              <span>Neutral (25%)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color sad"></div>
              <span>Sad (10%)</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="guide-section">
        <h3><span class="icon">‚öôÔ∏è</span> Advanced Features & Tools</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
          <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 15px; border-radius: 8px;">
            <h4 style="color: #1565c0; margin-bottom: 8px;">üìñ Guide Button</h4>
            <p style="color: #555; font-size: 13px;">Access this comprehensive guide anytime for help</p>
          </div>
          
          <div style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); padding: 15px; border-radius: 8px;">
            <h4 style="color: #2e7d32; margin-bottom: 8px;">üîë Keyword Reference</h4>
            <p style="color: #555; font-size: 13px;">View the keywords used for sentiment classification</p>
          </div>
          
          <div style="background: linear-gradient(135deg, #fff3e0, #ffe0b2); padding: 15px; border-radius: 8px;">
            <h4 style="color: #f57c00; margin-bottom: 8px;">üì§ Export Data</h4>
            <p style="color: #555; font-size: 13px;">Download results in CSV, JSON, or PDF formats</p>
          </div>
          
          <div style="background: linear-gradient(135deg, #f3e5f5, #e1bee7); padding: 15px; border-radius: 8px;">
            <h4 style="color: #7b1fa2; margin-bottom: 8px;">üìä Compare</h4>
            <p style="color: #555; font-size: 13px;">Compare sentiment across companies and sectors</p>
          </div>
        </div>
        
        <div style="background: #fff8e1; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffa000;">
          <h4 style="color: #ff8f00; margin-bottom: 10px;">üß™ Test Analysis Feature</h4>
          <p style="color: #555; font-size: 14px;">Use the "Test" button in the sidebar to analyze custom text. This helps you understand how the sentiment analysis works and test specific content.</p>
        </div>
      </div>
      
      <div class="guide-section">
        <h3><span class="icon">üí°</span> Pro Tips & Best Practices</h3>
        
        <div style="background: #f3e5f5; padding: 20px; border-radius: 12px;">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
              <h4 style="color: #7b1fa2; font-size: 14px; margin-bottom: 8px;">üîÑ Regular Updates</h4>
              <p style="color: #555; font-size: 13px;">Set auto-refresh for real-time sentiment tracking</p>
            </div>
            <div>
              <h4 style="color: #7b1fa2; font-size: 14px; margin-bottom: 8px;">üìà Trend Analysis</h4>
              <p style="color: #555; font-size: 13px;">Export data regularly to track sentiment trends</p>
            </div>
            <div>
              <h4 style="color: #7b1fa2; font-size: 14px; margin-bottom: 8px;">üîç Context Matters</h4>
              <p style="color: #555; font-size: 13px;">Consider industry context when interpreting scores</p>
            </div>
            <div>
              <h4 style="color: #7b1fa2; font-size: 14px; margin-bottom: 8px;">üì± Mobile Friendly</h4>
              <p style="color: #555; font-size: 13px;">Access from any device with responsive design</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="guide-section">
        <h3><span class="icon">‚ùì</span> Need More Help?</h3>
        <p>If you have questions or need assistance:</p>
        <ul style="color: #555; line-height: 1.6;">
          <li>Check the <strong>Keyword Reference</strong> for understanding sentiment classification</li>
          <li>Use the <strong>Test Analysis</strong> feature to experiment with custom text</li>
          <li>Export your data for deeper analysis in spreadsheet software</li>
          <li>Compare companies to identify sector trends and outliers</li>
        </ul> 
      </div>
    </div>
    <!-- FIXED: Sticky footer for buttons -->
    <div class="modal-actions-sticky">
      <button class="modal-btn btn-cancel" onclick="closeGuideModal()">Close Guide</button>
      <button class="modal-btn btn-save" onclick="closeGuideModal(); openKeywordModal();">
        <span class="icon">üîë</span>
        <span>View Keyword Reference</span>
      </button>
    </div>
  </div>
</div>

<!-- Keyword Reference Modal -->
<div class="modal-overlay" id="keywordModal" style="display: none;">
  <div class="modal keyword-modal">
    <div class="modal-header">
      <h2><span class="icon">üîë</span> Keyword Reference</h2>
      <button class="modal-close" onclick="closeKeywordModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="guide-section">
        <h3><span class="icon">üí°</span> How Keywords Work</h3>
        <p>These keywords are used to classify sentiment in company news and articles. The system analyzes content and counts occurrences of these keywords to determine emotional sentiment.</p>
      </div>
      
      <div class="keyword-categories">
        <div class="keyword-category">
          <h4><span class="icon">üòä</span> Happy Keywords</h4>
          <p>Positive sentiment indicators</p>
          <div class="keyword-list">
            <span class="keyword-tag happy">success</span>
            <span class="keyword-tag happy">growth</span>
            <span class="keyword-tag happy">profit</span>
            <span class="keyword-tag happy">achievement</span>
            <span class="keyword-tag happy">breakthrough</span>
            <span class="keyword-tag happy">record</span>
            <span class="keyword-tag happy">surge</span>
            <span class="keyword-tag happy">soar</span>
            <span class="keyword-tag happy">milestone</span>
            <span class="keyword-tag happy">positive</span>
            <span class="keyword-tag happy">win</span>
            <span class="keyword-tag happy">gain</span>
            <span class="keyword-tag happy">improve</span>
          </div>
        </div>
        
        <div class="keyword-category">
          <h4><span class="icon">üòê</span> Neutral Keywords</h4>
          <p>Factual or balanced indicators</p>
          <div class="keyword-list">
            <span class="keyword-tag neutral">announced</span>
            <span class="keyword-tag neutral">reported</span>
            <span class="keyword-tag neutral">according</span>
            <span class="keyword-tag neutral">data</span>
            <span class="keyword-tag neutral">quarterly</span>
            <span class="keyword-tag neutral">meeting</span>
            <span class="keyword-tag neutral">update</span>
            <span class="keyword-tag neutral">statement</span>
            <span class="keyword-tag neutral">results</span>
            <span class="keyword-tag neutral">release</span>
            <span class="keyword-tag neutral">information</span>
            <span class="keyword-tag neutral">details</span>
          </div>
        </div>
        
        <div class="keyword-category">
          <h4><span class="icon">üò¢</span> Sad Keywords</h4>
          <p>Negative sentiment indicators</p>
          <div class="keyword-list">
            <span class="keyword-tag sad">loss</span>
            <span class="keyword-tag sad">decline</span>
            <span class="keyword-tag sad">drop</span>
            <span class="keyword-tag sad">decrease</span>
            <span class="keyword-tag sad">struggle</span>
            <span class="keyword-tag sad">challenge</span>
            <span class="keyword-tag sad">issue</span>
            <span class="keyword-tag sad">concern</span>
            <span class="keyword-tag sad">negative</span>
            <span class="keyword-tag sad">fall</span>
            <span class="keyword-tag sad">problem</span>
            <span class="keyword-tag sad">difficulty</span>
          </div>
        </div>
      </div>
      
      <div class="guide-section">
        <h3><span class="icon">‚öñÔ∏è</span> Scoring System</h3>
        <p>Each keyword is weighted based on emotional intensity and context. The system calculates sentiment scores by analyzing keyword frequency, context, and relationships.</p>
      </div>
    </div>
    <div class="modal-actions-sticky">
      <button class="modal-btn btn-cancel" onclick="closeKeywordModal()">Close</button>
    </div>
  </div>
</div>

<!-- Export Modal -->
<div class="modal-overlay" id="exportModal" style="display: none;">
  <div class="modal export-modal">
    <div class="modal-header">
      <h2><span class="icon">üì§</span> Export Data</h2>
      <button class="modal-close" onclick="closeExportModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="guide-section">
        <h3><span class="icon">üìÅ</span> Choose Export Format</h3>
        <p>Select the format that best suits your needs:</p>
        
        <div class="export-options">
          <div class="export-option" data-format="csv">
            <div class="icon">üìä</div>
            <h4>CSV Format</h4>
            <p>Spreadsheet compatible, ideal for data analysis</p>
          </div>
          <div class="export-option" data-format="json">
            <div class="icon">üîß</div>
            <h4>JSON Format</h4>
            <p>Structured data, perfect for developers</p>
          </div>
          <div class="export-option" data-format="pdf">
            <div class="icon">üìÑ</div>
            <h4>PDF Report</h4>
            <p>Formatted report, ready for sharing</p>
          </div>
        </div>
      </div>
      
      <div class="guide-section">
        <h3><span class="icon">‚öôÔ∏è</span> Export Options</h3>
        <div style="display: flex; flex-direction: column; gap: 15px;">
          <div>
            <label style="display: flex; align-items: center; gap: 10px;">
              <input type="checkbox" id="includeAnalysis" checked>
              <span>Include sentiment analysis results</span>
            </label>
          </div>
          <div>
            <label style="display: flex; align-items: center; gap: 10px;">
              <input type="checkbox" id="includeRawData" checked>
              <span>Include raw data points</span>
            </label>
          </div>
          <div>
            <label style="display: flex; align-items: center; gap: 10px;">
              <input type="checkbox" id="includeCharts">
              <span>Include visualizations and charts</span>
            </label>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-actions-sticky">
      <button class="modal-btn btn-cancel" onclick="closeExportModal()">Cancel</button>
      <button class="modal-btn btn-save" onclick="performExport()">Export Data</button>
    </div>
  </div>
</div>

<!-- Compare Modal -->
<div class="modal-overlay" id="compareModal" style="display: none;">
  <div class="modal compare-modal">
    <div class="modal-header">
      <h2><span class="icon">üìä</span> Compare Companies</h2>
      <button class="modal-close" onclick="closeCompareModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="guide-section">
        <h3><span class="icon">üîç</span> Sentiment Comparison</h3>
        <p>Compare sentiment analysis across selected companies:</p>
        
        <div class="comparison-results">
          <div class="comparison-item">
            <div class="comparison-label">
              <span class="icon">üòä</span>
              <span>Happiest Company</span>
            </div>
            <div class="comparison-value" id="happiestCompany">-</div>
          </div>
          <div class="comparison-item">
            <div class="comparison-label">
              <span class="icon">üò¢</span>
              <span>Saddest Company</span>
            </div>
            <div class="comparison-value" id="saddestCompany">-</div>
          </div>
          <div class="comparison-item">
            <div class="comparison-label">
              <span class="icon">‚öñÔ∏è</span>
              <span>Most Balanced</span>
            </div>
            <div class="comparison-value" id="mostBalancedCompany">-</div>
          </div>
        </div>
      </div>
      
      <div class="guide-section">
        <h3><span class="icon">üìà</span> Performance Metrics</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
          <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 24px; font-weight: bold; color: #667eea;" id="totalCompanies">0</div>
            <div style="color: #666; font-size: 14px;">Total Companies</div>
          </div>
          <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 24px; font-weight: bold; color: #4caf50;" id="analyzedCompanies">0</div>
            <div style="color: #666; font-size: 14px;">Analyzed</div>
          </div>
          <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 24px; font-weight: bold; color: #ff9800;" id="avgSentiment">0%</div>
            <div style="color: #666; font-size: 14px;">Avg. Sentiment</div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-actions-sticky">
      <button class="modal-btn btn-cancel" onclick="closeCompareModal()">Close</button>
      <button class="modal-btn btn-save" onclick="exportComparison()">Export Comparison</button>
    </div>
  </div>
</div>

<!-- Enhanced Test Analysis Modal -->
<div class="modal-overlay" id="testModal" style="display: none;">
  <div class="modal test-modal">
    <div class="modal-header">
      <h2><span class="icon">üß™</span> Text Sentiment Analysis Test</h2>
      <button class="modal-close" onclick="closeTestModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="guide-section">
        <h3><span class="icon">üìÑ</span> Editable Test Page</h3>
        <p>Type or paste text below to analyze its sentiment using keyword-based scoring:</p>
        
        <div class="form-group">
          <label>Test Text Content</label>
          <textarea 
            id="testTextInput" 
            placeholder="Enter or paste text here for sentiment analysis..."
            rows="8"
            style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 14px; font-family: inherit; resize: vertical;"
          >NVIDIA continues to demonstrate strong innovation in AI and graphics technology. The company shows robust growth with high performance across multiple sectors. However, there are some concerns about market volatility and competition in certain areas. Overall, the benefits of their technology advancements outweigh the risks.</textarea>
        </div>
        
        <!-- FIXED: Action buttons positioned properly -->
        <div class="test-action-buttons">
          <button class="modal-btn btn-cancel" onclick="closeTestModal()">Close</button>
          <button class="modal-btn btn-save" onclick="runSentimentTest()">
            <span class="icon">üß™</span>
            Run Test
          </button>
        </div>
        
        <!-- NEW: Enhanced Results with Charts -->
        <div class="chart-container">
          <div class="chart-title">üìä Sentiment Analysis Results</div>
          <div class="sentiment-chart">
            <div class="chart-bar">
              <div class="chart-bar-label">
                <span>üòä Happy</span>
                <span class="chart-bar-value" id="happyScoreValue">0%</span>
              </div>
              <div class="chart-bar-track">
                <div class="chart-bar-fill happy" id="happyBar" style="width: 0%"></div>
              </div>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-label">
                <span>üò¢ Sad</span>
                <span class="chart-bar-value" id="sadScoreValue">0%</span>
              </div>
              <div class="chart-bar-track">
                <div class="chart-bar-fill sad" id="sadBar" style="width: 0%"></div>
              </div>
            </div>
          </div>
          
          <div class="pie-chart-container">
            <div class="pie-chart" id="sentimentPieChart">
              <div class="pie-chart-center" id="pieChartCenter">0%</div>
            </div>
          </div>
          <div class="pie-legend" id="sentimentLegend">
            <div class="legend-item">
              <div class="legend-color happy"></div>
              <span>Happy (<span id="legendHappy">0%</span>)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color sad"></div>
              <span>Sad (<span id="legendSad">0%</span>)</span>
            </div>
          </div>
        </div>
        
        <div class="keyword-categories" style="margin-top: 20px;">
          <div class="keyword-category">
            <h4><span class="icon">üòä</span> Positive Keywords</h4>
            <div class="keyword-list">
              <span class="keyword-tag happy">strong</span>
              <span class="keyword-tag happy">innovation</span>
              <span class="keyword-tag happy">benefits</span>
              <span class="keyword-tag happy">growth</span>
              <span class="keyword-tag happy">robust</span>
              <span class="keyword-tag happy">high performance</span>
              <span class="keyword-tag happy">success</span>
              <span class="keyword-tag happy">achievement</span>
              <span class="keyword-tag happy">breakthrough</span>
              <span class="keyword-tag happy">advantage</span>
            </div>
          </div>
          
          <div class="keyword-category">
            <h4><span class="icon">üò¢</span> Negative Keywords</h4>
            <div class="keyword-list">
              <span class="keyword-tag sad">weaknesses</span>
              <span class="keyword-tag sad">volatile</span>
              <span class="keyword-tag sad">risk</span>
              <span class="keyword-tag sad">vulnerable</span>
              <span class="keyword-tag sad">competition</span>
              <span class="keyword-tag sad">restrictions</span>
              <span class="keyword-tag sad">concerns</span>
              <span class="keyword-tag sad">challenges</span>
              <span class="keyword-tag sad">problems</span>
              <span class="keyword-tag sad">decline</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- FIXED: Sticky footer for additional actions -->
    <div class="modal-actions-sticky">
      <button class="modal-btn btn-cancel" onclick="clearTestResults()">Clear Results</button>
      <button class="modal-btn btn-save" onclick="exportTestResults()">
        <span class="icon">üì§</span>
        <span>Export Results</span>
      </button>
    </div>
  </div>
</div>

<div class="toast" id="toast">‚úÖ Action completed successfully!</div>

<script>
const API_URL = window.location.origin;

// Expanded Dummy Data for Tabs functionality
let companies = [
  {name:"Nvidia",sector:"Semiconductor",sad:null,neutral:null,happy:null},
  {name:"Pfizer",sector:"Pharma",sad:null,neutral:null,happy:null},
  {name:"Broadcom",sector:"Semiconductor",sad:null,neutral:null,happy:null},
  {name:"NextEra Energy",sector:"Electricity",sad:null,neutral:null,happy:null},
  {name:"TSMC",sector:"Semiconductor",sad:null,neutral:null,happy:null},
  {name:"Tesla",sector:"Automobile",sad:null,neutral:null,happy:null},
  {name:"Samsung",sector:"Semiconductor",sad:null,neutral:null,happy:null},
  {name:"Rio Tinto",sector:"Mining",sad:null,neutral:null,happy:null},
  {name:"IonQ",sector:"Quantum",sad:null,neutral:null,happy:null},
  {name:"AMD",sector:"Semiconductor",sad:null,neutral:null,happy:null}
];

let editIndex = -1;
let analysisInProgress = false;
let refreshInterval = null;
let currentSector = 'mylist'; // Default tab

// NEW: Tab-specific names with default values
let tabNames = {
  'mylist': 'My List',
  'Semiconductor': 'Semiconductors',
  'Pharma': 'Pharma',
  'Electricity': 'Electricity',
  'Mining': 'Mining',
  'Automobile': 'Automobile',
  'Quantum': 'Quantum'
};

function getRAG(sad, happy) {
  if (happy >= 70) return 'green';
  if (sad >= 70) return 'red';
  return 'yellow';
}

function showToast(message) {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// NEW: Function to handle MyList name editing
function enableMyListNameEdit() {
  const display = document.getElementById('mylistNameDisplay');
  const input = document.getElementById('mylistNameInput');
  const text = document.getElementById('mylistNameText');
  
  // Hide display, show input
  display.style.display = 'none';
  input.style.display = 'block';
  input.focus();
  input.select();
  
  // Handle input events
  input.onkeydown = function(e) {
    if (e.key === 'Enter') {
      saveMyListName();
    } else if (e.key === 'Escape') {
      cancelMyListNameEdit();
    }
  };
  
  input.onblur = function() {
    saveMyListName();
  };
}

// NEW: Save the edited MyList name
function saveMyListName() {
  const display = document.getElementById('mylistNameDisplay');
  const input = document.getElementById('mylistNameInput');
  const text = document.getElementById('mylistNameText');
  const newName = input.value.trim();
  
  if (newName) {
    // Update the tab name in our object
    tabNames[currentSector] = newName;
    
    // Update the display
    text.textContent = newName;
    
    // Update the tab name in navigation
    updateTabNameInNavigation(currentSector, newName);
    
    showToast('‚úÖ List name updated!');
  }
  
  // Reset UI
  display.style.display = 'flex';
  input.style.display = 'none';
}

// NEW: Update tab name in navigation
function updateTabNameInNavigation(sector, newName) {
  const navButtons = document.querySelectorAll('.nav-btn');
  navButtons.forEach(btn => {
    if (btn.getAttribute('data-sector') === sector) {
      const tabNameSpan = btn.querySelector('.tab-name');
      if (tabNameSpan) {
        tabNameSpan.textContent = newName;
      }
    }
  });
}

// NEW: Cancel MyList name editing
function cancelMyListNameEdit() {
  const display = document.getElementById('mylistNameDisplay');
  const input = document.getElementById('mylistNameInput');
  
  // Reset input value to current name
  input.value = tabNames[currentSector];
  
  // Reset UI
  display.style.display = 'flex';
  input.style.display = 'none';
}

// NEW: Function to handle MyList action buttons
function handleMyListAction(action) {
  switch(action) {
    case 'guide':
      openGuideModal();
      break;
    case 'keyword':
      openKeywordModal();
      break;
    case 'export':
      openExportModal();
      break;
    case 'compare':
      openCompareModal();
      break;
  }
}

// NEW: Open Guide Modal
function openGuideModal() {
  document.getElementById('guideModal').style.display = 'flex';
}

// NEW: Close Guide Modal
function closeGuideModal() {
  document.getElementById('guideModal').style.display = 'none';
}

// NEW: Open Keyword Reference Modal
function openKeywordModal() {
  document.getElementById('keywordModal').style.display = 'flex';
}

// NEW: Close Keyword Reference Modal
function closeKeywordModal() {
  document.getElementById('keywordModal').style.display = 'none';
}

// NEW: Open Export Modal
function openExportModal() {
  document.getElementById('exportModal').style.display = 'flex';
}

// NEW: Close Export Modal
function closeExportModal() {
  document.getElementById('exportModal').style.display = 'none';
}

// NEW: Open Compare Modal
function openCompareModal() {
  // Calculate comparison data
  const companiesWithData = companies.filter(c => c.sad !== null && c.neutral !== null && c.happy !== null);
  
  if (companiesWithData.length > 0) {
    // Find company with highest happy percentage
    const happiest = companiesWithData.reduce((prev, current) => 
      (prev.happy > current.happy) ? prev : current
    );
    
    // Find company with highest sad percentage
    const saddest = companiesWithData.reduce((prev, current) => 
      (prev.sad > current.sad) ? prev : current
    );
    
    // Find company with most balanced sentiment
    const mostBalanced = companiesWithData.reduce((prev, current) => {
      const prevDiff = Math.abs(prev.happy - prev.sad);
      const currentDiff = Math.abs(current.happy - current.sad);
      return (prevDiff < currentDiff) ? prev : current;
    });
    
    // Update UI
    document.getElementById('happiestCompany').textContent = `${happiest.name} (${happiest.happy}%)`;
    document.getElementById('saddestCompany').textContent = `${saddest.name} (${saddest.sad}%)`;
    document.getElementById('mostBalancedCompany').textContent = `${mostBalanced.name} (${mostBalanced.happy}% happy, ${mostBalanced.sad}% sad)`;
    
    // Update metrics
    document.getElementById('totalCompanies').textContent = companies.length;
    document.getElementById('analyzedCompanies').textContent = companiesWithData.length;
    
    // Calculate average sentiment
    const avgSentiment = companiesWithData.length > 0 
      ? Math.round(companiesWithData.reduce((sum, c) => sum + c.happy, 0) / companiesWithData.length)
      : 0;
    document.getElementById('avgSentiment').textContent = `${avgSentiment}%`;
  }
  
  document.getElementById('compareModal').style.display = 'flex';
}

// NEW: Close Compare Modal
function closeCompareModal() {
  document.getElementById('compareModal').style.display = 'none';
}

// NEW: Export Data Functionality
function performExport() {
  // Create CSV content
  let csvContent = "Company,Sector,Sad %,Neutral %,Happy %,RAG Status\n";
  
  companies.forEach(company => {
    const sad = company.sad || "N/A";
    const neutral = company.neutral || "N/A";
    const happy = company.happy || "N/A";
    const rag = getRAG(sad, happy);
    
    csvContent += `"${company.name}","${company.sector}","${sad}","${neutral}","${happy}","${rag}"\n`;
  });
  
  // Create download link
  const blob = new Blob([csvContent], { type: 'text/csv' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'sector_sentiment_analysis.csv';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  window.URL.revokeObjectURL(url);
  
  showToast('üì§ Data exported successfully!');
  closeExportModal();
}

// NEW: Export Comparison
function exportComparison() {
  showToast('üìä Comparison exported!');
  closeCompareModal();
}

// NEW: Test Button Functionality - Open Test Modal
function testAllCompanies() {
  openTestModal();
}

// NEW: Open Test Modal
function openTestModal() {
  document.getElementById('testModal').style.display = 'flex';
  // Reset scores when opening
  document.getElementById('happyScoreValue').textContent = '0%';
  document.getElementById('sadScoreValue').textContent = '0%';
  document.getElementById('legendHappy').textContent = '0%';
  document.getElementById('legendSad').textContent = '0%';
  document.getElementById('pieChartCenter').textContent = '0%';
  
  // Reset charts
  animateChartBars(0, 0);
  updatePieChart(0, 0);
}

// NEW: Close Test Modal
function closeTestModal() {
  document.getElementById('testModal').style.display = 'none';
}

// NEW: Enhanced Test Analysis with Visual Charts
function runSentimentTest() {
  const textInput = document.getElementById('testTextInput').value;
  
  if (!textInput.trim()) {
    showToast('‚ö†Ô∏è Please enter some text to analyze');
    return;
  }
  
  // Show loading state
  document.getElementById('happyScoreValue').textContent = '...';
  document.getElementById('sadScoreValue').textContent = '...';
  document.getElementById('pieChartCenter').textContent = '...';
  
  // Simulate analysis delay for better UX
  setTimeout(() => {
    const scores = analyzeTextSentiment(textInput);
    
    // Calculate percentages for visualization
    const totalScore = scores.happy + scores.sad;
    const happyPercent = totalScore > 0 ? Math.round((scores.happy / totalScore) * 100) : 0;
    const sadPercent = totalScore > 0 ? Math.round((scores.sad / totalScore) * 100) : 0;
    
    // Update text displays
    document.getElementById('happyScoreValue').textContent = `${happyPercent}%`;
    document.getElementById('sadScoreValue').textContent = `${sadPercent}%`;
    document.getElementById('legendHappy').textContent = `${happyPercent}%`;
    document.getElementById('legendSad').textContent = `${sadPercent}%`;
    document.getElementById('pieChartCenter').textContent = `${happyPercent}% Pos`;
    
    // Animate chart bars
    animateChartBars(happyPercent, sadPercent);
    
    // Update pie chart
    updatePieChart(happyPercent, sadPercent);
    
    showToast('‚úÖ Sentiment analysis complete!');
  }, 800);
}

// NEW: Animate chart bars
function animateChartBars(happyPercent, sadPercent) {
  const happyBar = document.getElementById('happyBar');
  const sadBar = document.getElementById('sadBar');
  
  // Reset widths first
  happyBar.style.width = '0%';
  sadBar.style.width = '0%';
  
  // Animate to target widths
  setTimeout(() => {
    happyBar.style.width = `${happyPercent}%`;
    sadBar.style.width = `${sadPercent}%`;
  }, 100);
}

// NEW: Update pie chart visualization
function updatePieChart(happyPercent, sadPercent) {
  const pieChart = document.getElementById('sentimentPieChart');
  const neutralPercent = 0; // Since we're only showing happy/sad in test
  
  pieChart.style.setProperty('--happy-percent', `${happyPercent}%`);
  pieChart.style.setProperty('--neutral-percent', `${neutralPercent}%`);
  pieChart.style.setProperty('--sad-percent', `${sadPercent}%`);
  
  // Update background with conic gradient
  pieChart.style.background = `conic-gradient(
    #4caf50 0% ${happyPercent}%,
    #f44336 ${happyPercent}% ${happyPercent + sadPercent}%
  )`;
}

// NEW: Clear test results
function clearTestResults() {
  document.getElementById('testTextInput').value = '';
  document.getElementById('happyScoreValue').textContent = '0%';
  document.getElementById('sadScoreValue').textContent = '0%';
  document.getElementById('legendHappy').textContent = '0%';
  document.getElementById('legendSad').textContent = '0%';
  document.getElementById('pieChartCenter').textContent = '0%';
  
  // Reset charts
  animateChartBars(0, 0);
  updatePieChart(0, 0);
  
  showToast('üßπ Test results cleared!');
}

// NEW: Export test results
function exportTestResults() {
  const happyPercent = document.getElementById('happyScoreValue').textContent;
  const sadPercent = document.getElementById('sadScoreValue').textContent;
  const textContent = document.getElementById('testTextInput').value.substring(0, 100) + '...';
  
  const exportData = {
    textSample: textContent,
    sentimentAnalysis: {
      happy: happyPercent,
      sad: sadPercent,
      timestamp: new Date().toISOString()
    }
  };
  
  const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'sentiment_analysis_test.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  window.URL.revokeObjectURL(url);
  
  showToast('üì§ Test results exported!');
}

// NEW: Keyword-based Sentiment Analysis
function analyzeTextSentiment(text) {
  // Convert text to lowercase for case-insensitive matching
  const lowerText = text.toLowerCase();
  
  // Define keyword lists
  const positiveKeywords = [
    'strong', 'innovation', 'benefits', 'growth', 'robust', 
    'high performance', 'success', 'achievement', 'breakthrough',
    'advantage', 'profit', 'gain', 'improve', 'positive', 'win'
  ];
  
  const negativeKeywords = [
    'weaknesses', 'volatile', 'risk', 'vulnerable', 'competition',
    'restrictions', 'concerns', 'challenges', 'problems', 'decline',
    'loss', 'drop', 'decrease', 'negative', 'fall', 'difficulty'
  ];
  
  // Count keyword occurrences
  let happyScore = 0;
  let sadScore = 0;
  
  positiveKeywords.forEach(keyword => {
    const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
    const matches = lowerText.match(regex);
    if (matches) {
      happyScore += matches.length;
    }
  });
  
  negativeKeywords.forEach(keyword => {
    const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
    const matches = lowerText.match(regex);
    if (matches) {
      sadScore += matches.length;
    }
  });
  
  return {
    happy: happyScore,
    sad: sadScore
  };
}

// New function to filter companies based on sector
function renderTable() {
  const tbody = document.getElementById('tableBody');
  const mylistHeader = document.getElementById('mylistHeader');
  const text = document.getElementById('mylistNameText');
  
  // Update MyList header with current tab name
  text.textContent = tabNames[currentSector];
  const input = document.getElementById('mylistNameInput');
  input.value = tabNames[currentSector];
  
  // Apply tab-specific styling
  mylistHeader.className = 'mylist-header';
  if (currentSector !== 'mylist') {
    mylistHeader.classList.add(currentSector.toLowerCase());
  }
  
  // Filter data
  let displayCompanies = [];
  if (currentSector === 'mylist') {
    displayCompanies = companies; // Show all for My List
  } else {
    displayCompanies = companies.filter(c => c.sector === currentSector);
  }

  if (displayCompanies.length === 0) {
      tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding:20px; color:#999;">No companies found in this sector.</td></tr>';
      return;
  }

  tbody.innerHTML = displayCompanies.map((c, i) => {
    // Find original index for actions to work correctly on the main array
    const originalIndex = companies.indexOf(c);
    
    let sadDisplay, neutralDisplay, happyDisplay, ragDisplay;
    
    if (c.sad === null || c.neutral === null || c.happy === null) {
      sadDisplay = '<span class="empty-cell">‚Äî</span>';
      neutralDisplay = '<span class="empty-cell">‚Äî</span>';
      happyDisplay = '<span class="empty-cell">‚Äî</span>';
      ragDisplay = '<span class="empty-cell">‚Äî</span>';
    } else if (c.sad === 'loading') {
      sadDisplay = '<span class="loading-cell">‚è≥</span>';
      neutralDisplay = '<span class="loading-cell">‚è≥</span>';
      happyDisplay = '<span class="loading-cell">‚è≥</span>';
      ragDisplay = '<span class="loading-cell">‚è≥</span>';
    } else {
      sadDisplay = `${c.sad}%`;
      neutralDisplay = `${c.neutral}%`;
      happyDisplay = `${c.happy}%`;
      ragDisplay = `<div class="rag-dot rag-${getRAG(c.sad, c.happy)}"></div>`;
    }
    
    return `
    <tr>
      <td><strong>${i + 1}</strong></td>
      <td class="company-name">${c.name}</td>
      <td><span class="sector-badge">${c.sector}</span></td>
      <td class="score-cell score-sad">${sadDisplay}</td>
      <td class="score-cell score-neutral">${neutralDisplay}</td>
      <td class="score-cell score-happy">${happyDisplay}</td>
      <td><div class="rag-cell">${ragDisplay}</div></td>
      <td>
        <div class="actions-cell">
          <button class="action-btn btn-edit" onclick="editCompany(${originalIndex})" title="Edit">‚úèÔ∏è</button>
          <button class="action-btn btn-delete" onclick="deleteCompany(${originalIndex})" title="Delete">üóëÔ∏è</button>
          <button class="action-btn btn-up" onclick="moveUp(${originalIndex})" title="Move Up">‚Üë</button>
          <button class="action-btn btn-down" onclick="moveDown(${originalIndex})" title="Move Down">‚Üì</button>
        </div>
      </td>
    </tr>
  `}).join('');
}

function startRefreshTimer(minutes) {
    if (refreshInterval) clearInterval(refreshInterval);
    
    const container = document.getElementById('timerLineContainer');
    const fill = document.getElementById('timerLineFill');
    const timeText = document.getElementById('timerTextTime');
    
    container.style.display = 'block';
    
    const duration = minutes * 60 * 1000;
    const endTime = Date.now() + duration;
    
    refreshInterval = setInterval(() => {
        const now = Date.now();
        const remaining = endTime - now;
        
        if (remaining <= 0) {
            clearInterval(refreshInterval);
            fill.style.width = '0%';
            timeText.textContent = 'Refreshing...';
            location.reload();
            return;
        }
        
        // Calculate percentage
        const percent = (remaining / duration) * 100;
        fill.style.width = percent + '%';
        
        // Format time mm:ss
        const m = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((remaining % (1000 * 60)) / 1000);
        timeText.textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        
        // Change colors based on remaining percentage
        fill.className = 'timer-line-fill'; // reset
        if (percent < 20) fill.classList.add('danger');
        else if (percent < 50) fill.classList.add('warning');
        
    }, 1000);
}

async function analyzeAllCompanies() {
  if (analysisInProgress) {
    showToast('‚ö†Ô∏è Analysis already in progress');
    return;
  }
  
  analysisInProgress = true;
  const analyzeBtn = document.getElementById('analyzeBtn');
  const timerDisplay = document.getElementById('timerDisplay');
  const statusDisplay = document.getElementById('statusDisplay');
  
  // Check Timer
  const timerMinutes = parseInt(document.getElementById('timerSelect').value);
  if (timerMinutes > 0) {
      startRefreshTimer(timerMinutes);
  } else {
      if(refreshInterval) clearInterval(refreshInterval);
      document.getElementById('timerLineContainer').style.display = 'none';
  }
  
  analyzeBtn.disabled = true;
  analyzeBtn.innerHTML = '<span class="icon">‚è≥</span><span>Analyzing...</span>';
  
  let completed = 0;
  // Only analyze visible companies or all? Usually all, but let's do all
  const total = companies.length;
  
  for (let i = 0; i < companies.length; i++) {
    const company = companies[i];
    
    // Update status in data
    companies[i].sad = 'loading';
    companies[i].neutral = 'loading';
    companies[i].happy = 'loading';
    renderTable(); // Refresh table to show loading states
    
    timerDisplay.textContent = `Analyzing ${company.name}...`;
    statusDisplay.textContent = `Processing ${completed + 1} of ${total}`;
    
    try {
      const response = await fetch(`${API_URL}/api/analyze-single`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ company_name: company.name })
      });
      
      const data = await response.json();
      
      if (data.result) {
        companies[i].sad = data.result.sad;
        companies[i].neutral = data.result.neutral;
        companies[i].happy = data.result.happy;
      } else {
        companies[i].sad = null; companies[i].neutral = null; companies[i].happy = null;
      }
    } catch (error) {
      console.error(`Error analyzing ${company.name}:`, error);
      companies[i].sad = null; companies[i].neutral = null; companies[i].happy = null;
    }
    
    renderTable();
    completed++;
    
    if (i < companies.length - 1) {
      await new Promise(resolve => setTimeout(resolve, 2000));
    }
  }
  
  analysisInProgress = false;
  analyzeBtn.disabled = false;
  analyzeBtn.innerHTML = '<span class="icon">üöÄ</span><span>Analyze All</span>';
  timerDisplay.textContent = 'Complete!';
  statusDisplay.textContent = `Analyzed ${total} companies`;
  showToast('‚úÖ Analysis completed for all companies!');
}

function openModal(index = -1) {
  editIndex = index;
  document.getElementById('modalTitle').textContent = index === -1 ? '‚ú® Add Company' : '‚úèÔ∏è Edit Company';
  if (index >= 0) {
    const c = companies[index];
    document.getElementById('companyName').value = c.name;
    document.getElementById('sectorSelect').value = c.sector;
  } else {
    document.getElementById('companyName').value = '';
    document.getElementById('sectorSelect').value = 'Semiconductor';
  }
  document.getElementById('modalOverlay').style.display = 'flex';
}

function closeModal() {
  document.getElementById('modalOverlay').style.display = 'none';
  editIndex = -1;
}

function saveCompany() {
  const name = document.getElementById('companyName').value.trim();
  if (!name) { showToast('‚ö†Ô∏è Please enter company name'); return; }
  const sector = document.getElementById('sectorSelect').value;
  
  const company = {name, sector, sad: null, neutral: null, happy: null};
  if (editIndex >= 0) {
    companies[editIndex].name = name;
    companies[editIndex].sector = sector;
    showToast('‚úÖ Company updated successfully!');
  } else {
    companies.push(company);
    showToast('‚úÖ Company added successfully!');
  }
  renderTable();
  closeModal();
}

function editCompany(i) { openModal(i); }

function deleteCompany(i) {
  if (confirm(`Delete "${companies[i].name}"?`)) {
    companies.splice(i, 1);
    renderTable();
    showToast('üóëÔ∏è Company deleted!');
  }
}

function moveUp(i) {
  if (i > 0) {
    [companies[i], companies[i-1]] = [companies[i-1], companies[i]];
    renderTable();
    showToast('‚¨ÜÔ∏è Moved up!');
  }
}

function moveDown(i) {
  if (i < companies.length - 1) {
    [companies[i], companies[i+1]] = [companies[i+1], companies[i]];
    renderTable();
    showToast('‚¨áÔ∏è Moved down!');
  }
}

document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('analyzeBtn').addEventListener('click', analyzeAllCompanies);
  
  // NEW: Test button functionality
  document.getElementById('testBtn').addEventListener('click', testAllCompanies);
  
  // NEW: MyList name editing functionality
  document.getElementById('mylistNameDisplay').addEventListener('click', enableMyListNameEdit);
  
  // NEW: MyList action buttons
  document.getElementById('guideBtn').addEventListener('click', () => handleMyListAction('guide'));
  document.getElementById('keywordRefBtn').addEventListener('click', () => handleMyListAction('keyword'));
  document.getElementById('exportBtn').addEventListener('click', () => handleMyListAction('export'));
  document.getElementById('compareBtn').addEventListener('click', () => handleMyListAction('compare'));
  
  // NEW: Close modal when clicking outside
  document.getElementById('guideModal').addEventListener('click', function(e) {
    if (e.target === this) closeGuideModal();
  });
  
  document.getElementById('keywordModal').addEventListener('click', function(e) {
    if (e.target === this) closeKeywordModal();
  });
  
  document.getElementById('exportModal').addEventListener('click', function(e) {
    if (e.target === this) closeExportModal();
  });
  
  document.getElementById('compareModal').addEventListener('click', function(e) {
    if (e.target === this) closeCompareModal();
  });
  
  document.getElementById('testModal').addEventListener('click', function(e) {
    if (e.target === this) closeTestModal();
  });
  
  // NEW: Export option selection
  document.querySelectorAll('.export-option').forEach(option => {
    option.addEventListener('click', function() {
      document.querySelectorAll('.export-option').forEach(opt => opt.classList.remove('selected'));
      this.classList.add('selected');
    });
  });
  
  // Tab Switching Logic
  document.querySelectorAll('.nav-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      
      // Update current sector and re-render
      currentSector = this.getAttribute('data-sector');
      renderTable();
    });
  });
  
  document.getElementById('modalOverlay').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
  });
  
  renderTable();
});
</script>
</body>
</html>